{
  "version": 3,
  "sources": ["../.yarn/cache/itty-router-npm-4.0.0-next.46-fedbb6242e-5d31ac8683.zip/node_modules/itty-router/index.js", "../src/index.ts"],
  "sourcesContent": ["const e=({base:e=\"\",routes:t=[]}={})=>({__proto__:new Proxy({},{get:(s,o,r)=>(s,...n)=>t.push([o.toUpperCase(),RegExp(`^${(e+\"/\"+s).replace(/\\/+(\\/|$)/g,\"$1\").replace(/(\\/?\\.?):(\\w+)\\+/g,\"($1(?<$2>*))\").replace(/(\\/?\\.?):(\\w+)/g,\"($1(?<$2>[^$1/]+?))\").replace(/\\./g,\"\\\\.\").replace(/(\\/?)\\*/g,\"($1.*)?\")}/*$`),n])&&r}),routes:t,async handle(e,...s){let o,r,n=new URL(e.url),a=e.query={};for(let[e,t]of n.searchParams)a[e]=void 0===a[e]?t:[a[e],t].flat();for(let[a,c,l]of t)if((a===e.method||\"ALL\"===a)&&(r=n.pathname.match(c))){e.params=r.groups||{};for(let t of l)if(void 0!==(o=await t(e.proxy||e,...s)))return o}}});class t extends Error{status;constructor(e=500,t){\"object\"==typeof t?(super(t.error),Object.assign(this,t)):super(t),this.status=e}}const s=(e=\"text/plain; charset=utf-8\",t)=>(s,o={})=>{const{headers:r={},...n}=o;return\"Response\"===s?.constructor.name?s:new Response(t?t(s):s,{headers:{\"content-type\":e,...r},...n})},o=s(\"application/json; charset=utf-8\",JSON.stringify),r=e=>({400:\"Bad Request\",401:\"Unauthorized\",403:\"Forbidden\",404:\"Not Found\",500:\"Internal Server Error\"}[e]||\"Unknown Error\"),n=(e=500,t)=>{if(e instanceof Error){const{message:s,...o}=e;e=e.status||500,t={error:s||r(e),...o}}return t={status:e,...\"object\"==typeof t?t:{error:t||r(e)}},o(t,{status:e})},a=e=>new Response(null,{status:e}),c=(e,t)=>new Response(e,t),l=s(\"text/html\"),i=s(\"image/jpeg\"),p=s(\"image/png\"),u=s(\"image/webp\"),d=async e=>{e.headers.get(\"content-type\")?.includes(\"json\")&&(e.content=await e.json())},h=e=>{e.cookies=(e.headers.get(\"Cookie\")||\"\").split(/;\\s*/).map((e=>e.split(/=(.+)/))).reduce(((e,[t,s])=>(e[t]=s,e)),{})},g=e=>{e.proxy=new Proxy(e.proxy||e,{get:(e,t)=>void 0!==e[t]?e[t]:e?.params?.[t]})},f=(e={})=>{const{origins:t=[\"*\"],maxAge:s,methods:o=[\"GET\"],headers:r={}}=e;let n;const a={\"content-type\":\"application/json\",\"Access-Control-Allow-Methods\":o.join(\", \"),...r};s&&(a[\"Access-Control-Max-Age\"]=s);return{corsify:e=>{if(!e)throw new Error(\"No fetch handler responded and no upstream to proxy to specified.\");const{headers:t,status:s,body:o}=e;if([101,301,302,308].includes(s))return e;const r=Object.fromEntries(t);return r[\"access-control-allow-origin\"]?e:new Response(o,{status:s,headers:{...r,...a,...n,\"content-type\":t.get(\"content-type\")}})},preflight:e=>{const s=[...new Set([\"OPTIONS\",...o])],r=e.headers.get(\"origin\")||\"\";if(n=(t.includes(r)||t.includes(\"*\"))&&{\"Access-Control-Allow-Origin\":r},\"OPTIONS\"===e.method){if(null!==e.headers.get(\"Origin\")&&null!==e.headers.get(\"Access-Control-Request-Method\")&&null!==e.headers.get(\"Access-Control-Request-Headers\")){const t={...a,\"Access-Control-Allow-Methods\":s.join(\", \"),\"Access-Control-Allow-Headers\":e.headers.get(\"Access-Control-Request-Headers\"),...n};return new Response(null,{headers:t})}return new Response(null,{headers:{Allow:s.join(\", \")}})}}}};export{e as Router,t as StatusError,f as createCors,s as createResponse,n as error,l as html,i as jpeg,o as json,p as png,a as status,c as text,u as webp,d as withContent,h as withCookies,g as withParams};\n", "import { createCors, error, json, type RequestLike, Router, withParams } from 'itty-router'\n\nconst router = Router({ base: '/.well-known/matrix' }) // no \"new\", as this is not a real class\n\nconst { preflight, corsify } = createCors({\n  origins: ['*'],\n  methods: ['GET']\n})\n\nexport interface Env {\n  MATRIX_SERVER_ADDR: string\n}\n\nconst missing = (message = 'Not found.'): Response => error(404, message)\n\nrouter\n  .options('*', preflight) // handle CORS OPTIONS requests\n// withParams can now be used globally\n  .all('*', withParams)\n  .get('/client',\n    (request: RequestLike, env: Env, context: ExecutionContext) =>\n      ({ 'm.homeserver': { base_url: 'https://' + env.MATRIX_SERVER_ADDR } }))\n  .get('/server',\n    (request: RequestLike, env: Env, context: ExecutionContext) =>\n      ({ 'm.server': env.MATRIX_SERVER_ADDR }))\n// 404 for all else\n  .all('*', () => missing('Are you sure about that?')) // 404 for all else\n\nexport default {\n  // fetch: router.handle,\n  fetch: async (request: RequestLike, env: Env, context: ExecutionContext) => await router\n    .handle(request, env, context)\n    .then(json) // if sent raw data, wrap it in a Response\n    .catch((err) => error(500, err.stack))\n    .then(corsify)\n}\n"],
  "mappings": "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",
  "names": ["e", "o", "r", "s", "n", "a", "t", "l", "s", "o", "r", "n", "l", "s", "i", "p", "u", "g", "e", "t", "f", "o", "r", "n", "a", "s", "router", "e", "preflight", "corsify", "f", "missing", "message", "n", "g", "request", "env", "context", "src_default", "o", "err"]
}
